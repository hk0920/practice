<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
  <html>
    <head>
      <title>index</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin>
    </head>
    <style>
      #background{background:grey}
    </style>
    <body style="height:98%;width:100%;"> 
      <div class="modal" tabindex="-1" role="dialog"> 
        <div class="modal-dialog modal-lg" role="document" style="min-width:75%"> 
          <div class="modal-content"> 
            <div class="modal-header"> 
              <h5 class="modal-title">Modal title</h5> 
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"> 
                <span aria-hidden="true">&times;</span> 
              </button> 
            </div> 
            <div class="modal-body"> 
              <table class="table table-bordered"> 
                <tr> 
                  <td> 
                    <div id="mosaic_body" style="position:relative;display:inline-block;"> 
                      <canvas class="mosaic" id="originBackground" style="position:absolute;"></canvas> 
                      <canvas class="mosaic" id="background" style="position:absolute;"></canvas> 
                      <canvas class="mosaic" id="canvas_drawing" style="position:absolute;"></canvas> 
                      <canvas class="mosaic" id="hover" style="position:absolute;"></canvas> 
                    </div> 
                  </td> 
                  <td> 
                    <input type="button" value="모자이크 기능" id="changeDrawing" class="btn btn-primary">
                    <br><br> 
                    <select id="selectors" class="form-control"> 
                      
                      <option value="100">크기 : 기본(100)</option> 
                      <option value="50">크기 : 작게(50)</option> 
                      <option value="200">크기 : 크게(200)</option> 
                      <option value="400">크기 : 정말크게(400)</option> 
                    </select> 
                    <br> 
                    <select id="mozSize" class="form-control"> 
                      <option value="10">간격 : 기본(10)</option> 
                      <option value="20">간격 : 넓게(20)</option> 
                      <option value="30">간격 : 매우 넓게(30)</option> 
                      <option value="5">간격 : 세밀하게(5)</option> 
                      <option value="2">간격 : 매우 세밀하게(2)</option> 
                    </select> 
                    <br> 
                    <input type="button" value="이미지 출력" onclick="rts.toImage()" class="btn btn-success"> 
                  </td> 
                </tr> 
              </table> 
            </div> 
            <div class="modal-footer"> 
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> 
            </div> 
          </div> 
        </div> 
      </div>  
    </body>
  </html>
  <script>
    pparcelRequire = (function (e, r, t, n) {
    var i,
        o = "function" == typeof parcelRequire && parcelRequire,
        u = "function" == typeof require && require;
    function f(t, n) {
        if (!r[t]) {
            if (!e[t]) {
                var i = "function" == typeof parcelRequire && parcelRequire;
                if (!n && i) return i(t, !0);
                if (o) return o(t, !0);
                if (u && "string" == typeof t) return u(t);
                var c = new Error("Cannot find module '" + t + "'");
                throw ((c.code = "MODULE_NOT_FOUND"), c);
            }
            (p.resolve = function (r) {
                return e[t][1][r] || r;
            }),
                (p.cache = {});
            var l = (r[t] = new f.Module(t));
            e[t][0].call(l.exports, p, l, l.exports, this);
        }
        return r[t].exports;
        function p(e) {
            return f(p.resolve(e));
        }
    }
    (f.isParcelRequire = !0),
        (f.Module = function (e) {
            (this.id = e), (this.bundle = f), (this.exports = {});
        }),
        (f.modules = e),
        (f.cache = r),
        (f.parent = o),
        (f.register = function (r, t) {
            e[r] = [
                function (e, r) {
                    r.exports = t;
                },
                {},
            ];
        });
    for (var c = 0; c < t.length; c++)
        try {
            f(t[c]);
        } catch (e) {
            i || (i = e);
        }
    if (t.length) {
        var l = f(t[t.length - 1]);
        "object" == typeof exports && "undefined" != typeof module
            ? (module.exports = l)
            : "function" == typeof define && define.amd
            ? define(function () {
                  return l;
              })
            : n && (this[n] = l);
    }
    if (((parcelRequire = f), i)) throw i;
    return f;
})(
    {
        cDIQ: [
            function (require, module, exports) {
                var e = document.getElementById("background"),
                    t = e.getContext("2d"),
                    a = document.getElementById("originBackground"),
                    n = a.getContext("2d"),
                    r = document.getElementById("canvas_drawing"),
                    o = r.getContext("2d"),
                    i = document.getElementById("hover"),
                    c = i.getContext("2d"),
                    l = 800,
                    g = 800,
                    d = new Image();
                (d.src = "test.png"),
                    (d.onload = function () {
                        if (((l = d.width), (g = d.height), l > 1e3)) for (; l > 1e3; ) (l *= 0.9), (g *= 0.9);
                        $(".mosaic").each(function () {
                            $(this).attr({ width: l, height: g });
                        }),
                            $("#mosaic_body").css({ width: l, height: g }),
                            t.drawImage(d, 0, 0, l, g),
                            n.drawImage(d, 0, 0, l, g);
                    });
                var s = !0,
                    u = 100,
                    m = u / 2,
                    f = [],
                    h = 1,
                    v = 10,
                    b = 10;
                function y() {
                    return $("#mosaic_body").offset();
                }
                function x(e) {
                    var t = e.clientX - y().left - m,
                        a = e.clientY - y().top - m;
                    o.save(), o.clearRect(t, a, u, u), f.push({ x: t, y: a, type: "clear", box_size: u }), o.restore();
                }
                function I(e, t) {
                    var a = e.clientX - y().left,
                        n = e.clientY - y().top;
                    p(a, n), f.push({ x: a - m, y: n - m, type: "draw", box_size: u });
                }
                function p(e, a) {
                    o.save();
                    var n = t.getImageData(e - m, a - m, u, u),
                        r = n.data,
                        i = n.width / v,
                        c = n.height / b;
                    function l(n, r) {
                        var o,
                            l,
                            g = -4,
                            d = { r: 0, g: 0, b: 0 },
                            s = 0;
                        try {
                            var f = (r / c) * u,
                                y = (n / i) * u;
                            o = t.getImageData(e + f - m, a + y - m, v, b);
                        } catch (x) {
                            return d;
                        }
                        for (l = o.data.length; (g += 4 * h) < l; ) ++s, (d.r += o.data[g]), (d.g += o.data[g + 1]), (d.b += o.data[g + 2]);
                        return (d.r = ~~(d.r / s)), (d.g = ~~(d.g / s)), (d.b = ~~(d.b / s)), (o = null), d;
                    }
                    for (var g = 0; g < i; g++)
                        for (var d = 0; d < c; d++)
                            for (var s = l(g, d), f = s.r, y = s.g, x = s.b, I = 0; I < b; I++)
                                for (var p = 0; p < v; p++) {
                                    var w = d * v + p,
                                        $ = (g * b + I) * (4 * n.width) + 4 * w;
                                    (r[$ + 0] = f), (r[$ + 1] = y), (r[$ + 2] = x), (r[$ + 3] = 255);
                                }
                    o.putImageData(n, e - m, a - m), o.restore();
                }
                function w() {
                    console.log(u),
                        f.forEach(function (e) {
                            var a = null;
                            "clear" != e.type ? ((a = o.getImageData(e.x, e.y, e.box_size, e.box_size)), t.putImageData(a, e.x, e.y)) : ((a = n.getImageData(e.x, e.y, e.box_size, e.box_size)), t.putImageData(a, e.x, e.y));
                        });
                    var e = document.createElement("a");
                    (e.download = "filename.png"), (e.href = document.getElementById("background").toDataURL()), e.click(), t.clearRect(0, 0, l, g);
                    var a = n.getImageData(0, 0, l, g);
                    t.putImageData(a, 0, 0);
                }
                i.addEventListener("mousemove", function (e) {
                    var t = e.clientX - y().left - m,
                        a = e.clientY - y().top - m;
                    if ((c.save(), c.clearRect(0, 0, l, g), (c.lineWidth = 3), s)) {
                        (c.fillStyle = "blue"), (c.strokeStyle = "blue");
                        var n = o.measureText("모자이크").width / 2;
                        c.fillText("모자이크", t + u / 2 - n, a + u / 2);
                    } else {
                        (c.fillStyle = "orange"), (c.strokeStyle = "orange");
                        n = o.measureText("지우기").width / 2;
                        c.fillText("지우기", t + u / 2 - n, a + u / 2);
                    }
                    c.strokeRect(t, a, u, u), c.restore();
                }),
                    i.addEventListener("mouseout", function (e) {
                        c.clearRect(0, 0, l, g);
                    }),
                    i.addEventListener("click", function (e) {
                        s ? I(e, "single") : x(e);
                    }),
                    $("#selectors").change(function () {
                        var e = $(this).val();
                        (u = Number(e)), (m = u / 2);
                    }),
                    $("#mozSize").change(function () {
                        var e = $(this).val();
                        (v = e), (b = e);
                    }),
                    $("#changeDrawing").click(function () {
                        s ? ((s = !1), $(this).attr("class", "btn btn-warning").val("지우개 기능")) : ((s = !0), $(this).attr("class", "btn btn-primary").val("모자이크 기능"));
                    }),
                    $(".modal").modal("show"),
                    (module.exports.toImage = function () {
                        w();
                    });
            },
            {},
        ],
    },
    {},
    ["cDIQ"],
    "rts"
);

  </script>

</script>